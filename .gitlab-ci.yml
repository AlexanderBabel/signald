image: java:8-jdk

stages:
  - build
  - package

before_script:
  - export GRADLE_USER_HOME=`pwd`/.gradle

cache:
  paths:
    - .gradle/wrapper
    - .gradle/caches

build:
  stage: build
  script:
    - ./gradlew build

tar:
  stage: package
  script:
    - ./gradlew distTar
  artifacts:
    paths:
      - build/distributions/*.tar
    expire_in: 1 week

deb:
  stage: package
  before_script:
    - export VERSION=$(git describe --always --tags)
    - echo "Building signald version $VERSION"
  script:
    - ./gradlew deb
    - mv build/distributions/*.deb .
  artifacts:
    paths:
      - "*.deb"
    expire_in: 1 week

rpm:
  stage: package
  script:
    - ./gradlew buildRpm
  artifacts:
    paths:
      - build/distributions/*.rpm
    expire_in: 1 week
